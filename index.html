<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DSFW â€“ Druzhba Services For the Web</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 2rem auto; }
    input, button { margin: 0.5rem 0; padding: 0.5rem; width: 100%; }
    .hidden { display: none; }
    .file-entry { margin: 1rem 0; padding: 0.5rem; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h1>DSFW</h1>

  <div id="auth">
    <h2>Register</h2>
    <input id="reg-username" placeholder="Username" />
    <input id="reg-password" type="password" placeholder="Password" />
    <button onclick="register()">Register</button>

    <h2>Login</h2>
    <input id="login-username" placeholder="Username" />
    <input id="login-password" type="password" placeholder="Password" />
    <button onclick="login()">Login</button>
  </div>

  <div id="dashboard" class="hidden">
    <h2>Upload File</h2>
    <form id="uploadForm">
      <input type="file" name="file" required />
      <button type="submit">Upload</button>
    </form>

    <h3>Uploaded File Info</h3>
    <div id="fileInfo"></div>

    <h3>Delete File</h3>
    <input id="delete-id" placeholder="File ID to delete" />
    <button onclick="deleteFile()">Delete</button>
  </div>

  <script>
    let token = '';

    async function register() {
      const username = document.getElementById('reg-username').value;
      const password = document.getElementById('reg-password').value;
      const res = await fetch('/auth/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
      });
      alert(await res.text());
    }

    async function login() {
      const username = document.getElementById('login-username').value;
      const password = document.getElementById('login-password').value;
      const res = await fetch('/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
      });
      const data = await res.json();
      if (data.token) {
        token = data.token;
        document.getElementById('auth').classList.add('hidden');
        document.getElementById('dashboard').classList.remove('hidden');
      } else {
        alert('Login failed');
      }
    }

    document.getElementById('uploadForm').onsubmit = async e => {
      e.preventDefault();
      const form = new FormData(e.target);
      const res = await fetch('/files/upload', {
        method: 'POST',
        headers: { Authorization: token },
        body: form
      });
      const data = await res.json();
      document.getElementById('fileInfo').innerHTML = `
        <div class="file-entry">
          <strong>File URL:</strong> <a href="${data.url}/${data.accessCode}" target="_blank">${data.url}/${data.accessCode}</a><br>
          <strong>Access Code:</strong> ${data.accessCode}<br>
          <strong>File ID:</strong> ${data.url.split('/').pop()}
        </div>
      `;
    };

    async function deleteFile() {
      const id = document.getElementById('delete-id').value;
      const res = await fetch(`/files/${id}`, {
        method: 'DELETE',
        headers: { Authorization: token }
      });
      alert(await res.text());
    }
  </script>
</body>
</html>
